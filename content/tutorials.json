{
    "introduction": {
        "heading": "Introduction to MBX",
        "markdown_text": "# MBX v1.3.0\nMBX: A many-body energy and force calculator for data-driven many-body simulations.\n[J. Chem. Phys. 159, 054802 (2023)](https://doi.org/10.1063/5.0156036)\n\n\nMBX is a C++ software that can either be used as a standalone software for calculating energies and forces of MB-nrg potential energy functions (PEFs) for the molecular systems of interest or interfaced with external molecular dynamics and Monte Carlo engines to perform classical and quantum simulations of the molecular system of interest across different thermodynamic states and phases, in both periodic and non-periodic conditions, using the corresponding MB-nrg PEFs.\nThe current version of MBX provides interfaces to LAMMPS (https://www.lammps.org) and i-PI (http://ipi-code.org) which allow for performing classical and path-integral molecular dynamics simulations using MB-nrg PEFs. \nFor details on the MB-pol and MB-nrg PEFs, please visit: https://paesanigroup.ucsd.edu/software/mbx.html.\n\nMBX is periodically updated with performance improvements and the addition of other MB-nrg PEFs. For any questions about MBX, installation issues, or general usage inquiries, please use the MBX Google Group: https://groups.google.com/g/mbx-users.\n"
    },
    "tutorials": [
        {
            "heading": "Compilation and Installation",
            "markdown_text": "The following requirements need to be fulfilled in order to successfully install the software:\n- g++/gcc v4.9 or higher\n- icpc/icc v2018 or higher [optional but recommended]\n- MPI compilers [optional, needed only for LAMMPS]\n- FFTW libraries\n- GSL libraries [optional, needed only for normal_modes executable]\n- Read the entire README before doing anything!\n\n### Setup\nThe home directory of MBX will be referred to as `$MBX_HOME`. You must set this environment variable, which can be exported either manually or by sourcing `sourceme.sh`:\n```console\ngit clone https://github.com/paesanilab/MBX.git\ncd MBX/\nexport MBX_HOME=$PWD\n```\n\n### Compilation\nMBX has different compilation instructions depending on how you plan to use it:\n- For use with **i-PI**, **Python**, **Fortran**, or **standalone**, perform a basic installation using the steps below.\n- For use with **LAMMPS**, perform an [alternative MBX_MPI installation](lammps-interface)\n#### Basic installation of MBX (for use with i-PI, Python, Fortran, or standalone. **NOT LAMMPS**)\n```console\nautoreconf -fi\n./configure\nmake && make install\n```\n\n`./configure` has additional flags and options if you want to customize your installation:\n- `CXX=` if you want to use a different compiler than the system default. Popular options include `CXX=icpc` or `CXX=g++`\n- `--enable-shared` if you want to also compile MBX as a shared library. This is **required for using MBX with Python**.\n- `--enable-debug` for debugging using GDB.\n- `--enable-verbose` will turn on additional logging to the console.\n- `--disable-optimization` will disable compiler optimizations. This is **not recommended** unless you are debugging.\n- `--help` to see additional configuration options\n\nAfter performing basic installation, you should [run the unit tests](testing) to make sure everything is working properly.\n\n#### [Alternative installation of MBX_MPI](lammps-interface) (**LAMMPS only**)\nIf you want to use MBX with LAMMPS, instead [skip to this section about the LAMMPS plugin](lammps-interface). This special installation using MPI is **only compatible with LAMMPS** and is incompatible with i-PI, Python, Fortran or standalone usage. If you need to use any of these other plugins, perform a separate basic installation in a different directory."
        },
        {
            "heading": "Testing",
            "markdown_text": "## Testing\nAfter [basic installation](compilation-and-installation), running the unit tests is highly recommended. Run the following commands to run the tests:\n```\nmake check\n```\nAll tests must pass. If you encounter any errors, please report them in the [MBX Google Group](https://groups.google.com/g/mbx-users).\n\nTests will fail if using an MPI compiler instead of `g++`/`icpc`, such as if you performed alternative installation with MBX_MPI with LAMMPS. Please instead perform basic installation first with `g++`/`icpc` and then run the tests."
        },
        {
            "heading": "JSON File",
            "markdown_text": "To make life easier for you, a JSON configuration file must be used to pass all the information that MBX needs. Usually, one does not need to change anything except a couple of options. In any case, all the options of the json file are explained below.\n\nThe JSON file template is the following:\n```\n{\n   \"Note\" : \"This is a  MBX v1.0.0 configuration file\",\n   \"MBX\" : {\n       \"box\" : [21.0,0.0,0.0,0.0,21.0,0.0,0.0,0.0,21.0],\n       \"twobody_cutoff\"   : 9.0,\n       \"threebody_cutoff\" : 7.0,\n       \"dipole_tolerance\" : 1E-08,\n       \"dipole_max_it\"    : 100,\n       \"dipole_method\"     : \"cg\",\n       \"alpha_ewald_elec\" : 0.6,\n       \"grid_density_elec\" : 2.5,\n       \"spline_order_elec\" : 6,\n       \"alpha_ewald_disp\" : 0.6,\n       \"grid_density_disp\" : 2.5,\n       \"spline_order_disp\" : 6,\n       \"ignore_2b_poly\" : [],\n       \"ignore_3b_poly\" : []\n   } ,\n   \"i-pi\" : {\n       \"localhost\" : \"localhost3\",\n       \"port\" : 34567\n   }\n}\n```\nIn this file:\n- `box` is either a 9 element list, with the 3 vectors of the box: `[ax, ay, az, bx, by, bz, cx, cy, cz]` or an empty list `[]` if one wants to run gas-phase calculations.\n- `twobody_cutoff` is the distance at which the 2-body interactions will be cut in the real space. If you are using polynomials, that should be the largest polynomial cutoff that you are using (usually `9.0` Angstrom) in periodic boundary conditions. In gas phase calculations, that should be set to a large number so the real space electrostatics and dispersion are properly calculated and fully accounted for.\n- `threebody_cutoff` is the cutoff for the 3-body polynomials. If only water is used, one can set that to `4.5`, but if alkali metal ions or halides are used, it should be set to the maximum cutoff in any of the trimers used (`7.0`).\n- `dipole_tolerance` is the tolerance accepted for the induced dipoles iterative calculation. From one iteration to the other one, |mu(i,t+1) - mu(i,t)|^2 < dipole tolerance for any i. A value of `1E-08` is usually small enough. However, if the dipole solver used is aspc, the magnitude of the tolerance may have to be decreased up to `1E-10` or `1E-12`. It is recommended to run a few thousand steps using aspc and cg for the dipole solver, and decide which is the dipole tolerance needed.\n- `dipole_max_it` is the maximum number of iterations allowed in the dipole iterative method calculation. If the number of iterations exceeds this value, MBX will throw an error message saying that the dipoles have diverged.\n- `dipole_method` is the method adopted to calculate the induced dipoles. Current options are `iter` (iterative), `cg` (conjugate gradient, faster than iter), and `aspc` (always stable predictor-corrector). `aspc` is only suitable for simulations. Only `cg` and `aspc` are currently available in LAMMPS.\n- `alpha_ewald_{elec/disp}` is the alpha used in the reciprocal space. It should be set to `0.0` when running gas-phase calculations/simulations.\n- `grid_density_{elec/disp}` is the Ewald grid points density.\n- `spline_order_{elec/disp}` is the order of the splines used for interpolation.\n- `ignore_2b_poly` a list of 2 element lists with the monomer pairs for which the 2-body polynomials will not be calculated. Example: `\"ignore_2b_poly\" : [[\"na+\",\"h2o\"]]`\n- `ignore_3b_poly` has a similar format as ignore_2b_poly, but with the difference that the list is a list of 3-element list. If a set of three monomer types is specified in this list, MBX won't calculate the 3-body polynomials for that given trimer. Example: `\"ignore_3b_poly\" : [[\"na+\",\"h2o\",\"h2o\"]]`\n- `localhost` is the name of the socket. It MUST match the name in the XML file, otherwise it will send an error saying that the socket was not found.\n- `port` is used when interfacing with i-pi. It is the port that will hold the socket. Should be greater than `34500`."
        },
        {
            "heading": "Main executables",
            "markdown_text": "After installation, there will be the main executables in `$MBX_HOME/bin/`.\n- `single_point` will return the energy (Binding Energy) in kcal/mol for a given configuration. One can have multiple systems in the nrg file, and single point will return the energies of each one of them. If `PRINT_GRADS` is manually enabled in the source code in (`$MBX_HOME/src/main/single_point.cpp`) it will also print the gradients.\n- `optimize` will optimize a given configuration. You can optimize a single nrg system, or pass an XYZ file with a set of configurations, in which all of them will be optimized.\n- `mb_decomp` will compute energies for subsystems for the given system(s), then performs many-body decomposition and prints the n-body contribution for all subsystems. If the flag to skip many-body decomposition (\"`-e`\") is activated, it instead prints the binding energy for all subsystems.\n- `order_frames` will compute the energies for a given list of configurations from the XYZ file, and rearranges the configuration frames in the order of increasing energy.\n- `normal_modes` will compute the normal modes for an optimized nrg file. Requires the GSL library.\n"
        },
        {
            "heading": "PEFs implemented and How to Cite",
            "markdown_text": "## PEFs implemented\nAll the PEFs implemented, along with examples of input files and scripts to run various types of simulations, are provided in `$MBX_HOME/examples/PEFs`. If a surface is not there, its usage is not recommended because it is either not tested or not finalized. Example calls with C++, Fortran and Python are located inside each of the corresponding folders.\n\nPlease cite the corresponding manuscript whenever using MBX:\n- [J. Chem. Phys. 159, 054802 (2023)](https://doi.org/10.1063/5.0156036)\n\nPlease cite the following manuscripts if any of the following PEFs is used:\n- MB-pol for water\n  * [J. Chem. Theory Comput. 9, 5395 (2013)](https://doi.org/10.1021/ct400863t)\n  * [J. Chem. Theory Comput. 10, 1599 (2014)](https://doi.org/10.1021/ct500079y)\n  * [J. Chem. Theory Comput. 10, 2906 (2014)](https://doi.org/10.1021/ct5004115)\n  * [J. Chem. Phys. 145, 194504 (2016)](https://doi.org/10.1063/1.4967719)\n  * [Acc. Chem. Res. 49, 1844 (2016)](https://doi.org/10.1021/acs.accounts.6b00285)\n- MB-nrg PEFs for alkali-metal ions in water\n  * [J. Chem. Phys. 147, 161715 (2017)](https://doi.org/10.1063/1.4993213)\n  * [J. Phys. Chem. A 122, 5811 (2018)](https://doi.org/10.1021/acs.jpca.8b04106)\n  * [J. Phys. Chem. Lett. 10, 406 (2019)](https://doi.org/10.1021/acs.jpclett.8b03829)\n  * [J. Chem. Phys. 153, 044306 (2020)](https://doi.org/10.1063/5.0013101)\n  * [J. Chem. Theory Comput. 16, 3055 (2020)](https://doi.org/10.1021/acs.jctc.0c00082)\n  * [J. Phys. Chem. B. 126, 9349 (2022)](https://doi.org/10.1021/acs.jpcb.2c05674)\n- MB-nrg PEFs for halide ions in water\n  * [J. Chem. Theory Comput. 12, 2698 (2016)](https://doi.org/10.1063/5.0059445)\n  * [J. Chem. Phys. 148, 102321 (2018)](https://doi.org/10.1063/1.5005540)\n  * [J. Comp. Theory. Comput. 15, 2983 (2019)](https://doi.org/10.1021/acs.jctc.9b00064)\n  * [Nat. Chem. 11, 367 (2019)](https://www.nature.com/articles/s41557-019-0220-2)\n  * [J. Phys. Chem. Lett. 10, 2823 (2019)](https://doi.org/10.1021/acs.jpclett.9b00899)\n  * [J. Phys. Chem. A 123, 2843 (2019)](https://doi.org/10.1021/acs.jpca.9b00816)\n  * [Adv. Phys. X 4, 1631212 (2019)](https://doi.org/10.1080/23746149.2019.1631212)\n  * [J. Chem. Phys. 155, 064502 (2021)](https://doi.org/10.1063/5.0059445)\n  * [J. Phys. Chem. B 126, 8266 (2022)](https://doi.org/10.1021/acs.jpcb.2c04698)\n- MB-nrg PEFs for CO~2~ and CO~2~/H~2~O mixtures\n  * [J. Chem. Theory Comput. 16, 2246 (2020)](https://doi.org/10.1021/acs.jctc.9b01175)\n  * [J. Chem. Phys. 156, 104503 (2022)](https://doi.org/10.1063/5.0080061)\n- MB-nrg PEFs for CH~4~ and CH~4~/H~2~O mixtures\n  * [J. Phys. Chem. B 124, 11207 (2020)](https://doi.org/10.1021/acs.jpcb.0c08728)\n  * [J. Chem. Phys. 156, 194504 (2022)](https://doi.org/10.1063/5.0089773)\n- MB-nrg PEF for N~2~O~5~ in water\n  * [J. Chem. Theory Comput. 17, 3931 (2021)](https://doi.org/10.1021/acs.jctc.1c00069)\n"
        },
        {
            "heading": "LAMMPS interface",
            "markdown_text": "### LAMMPS\nMBX can interface with [LAMMPS](https://lammps.sandia.gov/) using a plugin for LAMMPS. In order to use MBX with LAMMPS, you must first install MBX with MPI compilers. You must use `mpicxx` or `mpiicpc` instead of `g++` or `icpc`. This can be done by running the following commands:\n```console\n# install MBX with MPI\nautoreconf -fi\n./configure --enable-mpi CXX=mpiicpc\nmake && make install\n```\nThis special installation using MPI is **only compatible with LAMMPS** and is incompatible with i-PI, Python, Fortran or standalone usage. If you need to use any of these other plugins, perform a separate [basic installation](#basic-installation-of-mbx-for-use-with-i-pi-python-fortran-or-standalone-not-lammps) in a different directory.\n\n\n After installing MBX, you can then download the stable branch of LAMMPS and then compile it with the MBX plugin:\n```console\ngit clone -b stable https://github.com/lammps/lammps.git LAMMPS-stable\nexport LAMMPS_HOME=$PWD/LAMMPS-stable\n\ncp -rf $MBX_HOME/plugins/lammps/USER-MBX $LAMMPS_HOME/src\ncd $LAMMPS_HOME/src/\nmake yes-USER-MBX yes-MOLECULE yes-KSPACE yes-RIGID yes-EXTRA-PAIR\nmake mpi_mbx -j 4 CXX=mpiicpc\n```\nAfter this, a new executable `lmp_mpi_mbx` in `$LAMMPS_HOME/src` should appear, and that is the executable you have to use for LAMMPS.\n\nAdditional documentation will follow up. For now, please look at the examples in `MBX_HOME/plugins/lammps` to see how it is run. For any questions, please use the MBX Google Group: https://groups.google.com/g/mbx-users.\n"
        },
        {
            "heading": "Using MB-pol with other force fields",
            "markdown_text": "## Using MB-pol with other force fields\n**MB-pol** can also be used in combination with conventional force fields using standard Lorentz-Berthelot mixing rules. For these simulations, we recommend using the following Lennard-Jones parameters for the oxygen and hydrogen atoms of the **MB-pol** water molecules:\n\nσ~OO~ = 3.26393 Å,\nε~OO~ = 0.26948 kcal/mol,\nσ~HH~ = 2.68354 Å,\nε~HH~ = 3.7 x 10^-10^ kcal/mol,\n\nSimulations carried out with MB-pol in combination with conventional force fields were used to characterize the mechanisms of ice formation at the interface of antifreeze proteins, the structure and dynamics of water at the interface of organic monolayers, and the mechanisms of water adsorption in metal-organic frameworks for applications in water harvesting from air.\n"
        },
        {
            "heading": "Fortran and Python interfaces",
            "markdown_text": "### Fortran90 and Python\nIn `${MBX_HOME}/examples/PEFs` there are sample scripts on how to use MBX called from Fortran90 and Python. Please remember to update the `LD_LIBRARY_PATH` variable and, if using python, the `PYTHONPATH` variable.\n```console\nexport LD_LIBRARY_PATH=$MBX_HOME/lib/:$LD_LIBRARY_PATH\nexport PYTHONPATH=${PYTHONPATH}:${MBX_HOME}/plugins/python/mbx\n```"
        }
    ]
}
